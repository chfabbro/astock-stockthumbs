{"version":3,"sources":["../src/custom-stockthumbs.js"],"names":[],"mappings":"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","file":"custom-stockthumbs.min.js","sourcesContent":["console.log('Custom script loaded');\n\n(() => {\n  const cpThumbs = {};\n  let stockThumbsConfig = {};\n\n  function getTmplString(html, args) {\n    return html.call(this, args);\n  }\n\n  // converts html string to DOM element\n  // taken from https://stackoverflow.com/a/35385518\n  const htmlToElement = ((htmlString) => {\n    const template = document.createElement('template');\n    const html = htmlString.trim();\n    template.innerHTML = html;\n    return template.content.firstChild;\n  });\n\n  /**\n   * Creates node list from search data\n   * @param {array} files array of JSON data\n   * @returns {object} document fragment list of nodes\n   */\n  const createThumbList = ((files) => {\n    const cp = cpThumbs;\n    const stc = stockThumbsConfig;\n    // create cta tracking url and text\n    const { utils, overlayText, ctaUrl } = cp;\n    const ctaText = overlayText(utils.getTrackingUrl(`${ctaUrl}?as_campaign=${utils.getHost()}`, stc));\n    // create doc fragment consisting of node list\n    const list = document.createDocumentFragment();\n    files.forEach((row) => {\n      // create substitution values for html string\n      const args = {\n        ctaText,\n      };\n      // add result fields\n      Object.entries(row).forEach((field) => {\n        // transform details URL with tracking data\n        if (field[0] === 'details_url') {\n          args.details_url = utils.getTrackingUrl(field[1], stc);\n        } else {\n          // eslint-disable-next-line prefer-destructuring\n          args[field[0]] = field[1];\n        }\n      });\n      // replace variables in html string and create thumb node\n      list.appendChild(htmlToElement(getTmplString(cp.html, args)));\n    });\n    return list;\n  });\n\n  /**\n   * Returns cloned nodes for further manipulation\n   * @param {string} name DOM name of parent\n   * @returns {object} cloned node\n   */\n  const cloneNodeList = (name) => {\n    // will only get first matching element\n    const parent = document.querySelector(name) || null;\n    const nodeClone = parent.cloneNode(true);\n    return nodeClone.childNodes;\n  };\n\n  /**\n   * Removes all node children\n   * @param {string} name DOM name of parent\n   * @returns {object} emptied node\n   */\n  const emptyNode = (name) => {\n    const el = document.querySelector(name);\n    while (el.firstChild) {\n      el.removeChild(el.firstChild);\n    }\n    return el;\n  };\n\n  /**\n   * Interleaves target node members with nodes from source\n   * 1. Get [count] nodes from source and add to newList\n   * 2. Add [count] target nodes\n   * 3. If repeat is true, return to 1\n   * 4. Add rest of target nodes   * @param {object} source new node list content\n   * @param {object} target existing node list to be combined\n   * @param {array} prefs (number, boolean) number of items to interleave, and whether to repeat\n   * @returns {object} combined node list with new children\n   */\n  const combineNodes = (source, target, prefs) => {\n    // set how many items to interleave (default 1)\n    let count = 1;\n    // sets whether to repeat insertion (default true)\n    let repeat = true;\n    // check if prefs array is set\n    if (prefs) {\n      count = (typeof prefs[0] === 'number') ? prefs[0] : count;\n      repeat = (prefs[1] !== undefined && prefs[1] !== null && typeof prefs[1] === 'boolean') ? prefs[1] : repeat;\n    }\n    // returns new nodelist\n    const newList = document.createDocumentFragment();\n    // convert target and source node list to array\n    let srcNodeList = Array.from(source.childNodes)\n    let targNodeList = Array.from(target);\n    const getValidNode = (arr) => {\n      let node = null;\n      while (arr.length > 0 && !node) {\n        // get first element\n        const tempNode = arr.shift();\n        // check if element\n        if (tempNode.nodeType === Node.ELEMENT_NODE) {\n          node = tempNode.cloneNode(true);\n        }\n      }\n      return {\n        node,\n        list: arr,\n      };\n    };\n    while (targNodeList.length > 0) {\n      // build list of source nodes\n      for (let srcIdx = 0; srcIdx < count; srcIdx += 1) {\n        // check if element node and add to new list\n        const nodeCheck = getValidNode(srcNodeList);\n        if (nodeCheck.node) {\n          // add to list\n          newList.appendChild(nodeCheck.node);\n          // update array\n          srcNodeList = nodeCheck.list;\n        }\n      }\n      // now do the same for target nodes if repeat is true\n      if (repeat) {\n        for (let srcIdx = 0; srcIdx < count; srcIdx += 1) {\n          const nodeCheck = getValidNode(targNodeList);\n          if (nodeCheck.node) {\n            // add to list\n            newList.appendChild(nodeCheck.node);\n            // update array\n            targNodeList = nodeCheck.list;\n          }\n        }\n      } else {\n        // add remainder of nodes to list\n        while (targNodeList.length > 0) {\n          const targetNode = targNodeList.shift();\n          newList.appendChild(targetNode.cloneNode(true));\n        }\n      }\n    }\n    return newList;\n  };\n\n  // add global objects if they don't exist\n  const StockThumbs = window.StockThumbs || {};\n  StockThumbs.config = StockThumbs.config || {};\n  StockThumbs.config.custom = StockThumbs.config.custom || {};\n\n  // run any setup code here\n  StockThumbs.config.custom.init = (config, stockThumbsMain) => {\n    console.log('custom init called');\n    // get access to utility methods\n    stockThumbsConfig = config;\n    const cp = cpThumbs;\n    // store utility functions and custom text/html\n    cp.utils = stockThumbsMain.utils;\n    cp.resultColumns = stockThumbsConfig.custom.result_columns;\n    cp.overlayText = stockThumbsConfig.custom.overlayText;\n    cp.ctaUrl = stockThumbsConfig.custom.ctaUrl;\n    cp.html = stockThumbsConfig.custom.html;\n    if (!cp.overlayText || !cp.html || !cp.resultColumns) {\n      throw new Error('StockThumbs config is missing required overlayText, html, or result_columns members.');\n    } else if (!(typeof cp.html === 'function')) {\n      throw new Error('html element in StockThumbs config must be a function which returns a template string.');\n    }\n  };\n  // run main functionality after search\n  StockThumbs.config.custom.exec = (result) => {\n    console.log('custom exec called');\n    const stc = stockThumbsConfig;\n    // creates document fragment consisting of new list of nodes\n    const source = createThumbList(result);\n    // gets child nodes from cloned target\n    const target = cloneNodeList(stc.parentId);\n    if (!source || !target) {\n      throw new Error('ParentID or HTML is invalid');\n    }\n    const combined = combineNodes(source, target, stc.custom.interleave);\n    if (window.jQuery && window.Masonry) {\n      const $jq = window.jQuery;\n      // replace existing node children with new list\n      emptyNode(stc.parentId).appendChild(combined);\n      const $cont = $jq(stc.parentId);\n      $cont.imagesLoaded(() => {\n        // remove existing masonry\n        $cont.masonry('destroy');\n        // re-layout items\n        $cont.masonry({ itemSelector: '.edd_download' });\n      });\n    }\n  };\n})();\n\n// Make script visible in console. see https://stackoverflow.com/a/23701451\n// eslint-disable-next-line spaced-comment\n//# sourceURL=./custom-creativepixel.js\n"]}